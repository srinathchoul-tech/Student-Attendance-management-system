<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Attendance Management System - Dashboard</title>
    <link rel="manifest" href="./manifest.webmanifest">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --sidebar-bg: #4A148C;
            --header-bg: #7B1FA2;
            --primary: #9C27B0;
            --primary-light: #E1BEE7;
            --text-light: #f3f4f6;
            --text-dark: #1F2937;
            --success: #4CAF50;
            --warning: #FFC107;
            --danger: #F44336;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #F9FAFB;
            color: var(--text-dark);
        }

        .sidebar {
            background-color: var(--sidebar-bg);
            width: 280px;
            min-height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            transition: all 0.3s;
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .main-content {
            margin-left: 280px;
            transition: all 0.3s;
        }

        .nav-item {
            color: var(--text-light);
            padding: 0.8rem 1.5rem;
            display: flex;
            align-items: center;
            transition: all 0.3s;
            border-left: 4px solid transparent;
            margin: 0.25rem 1rem;
            border-radius: 0.375rem;
        }

        .nav-item:hover, .nav-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-left-color: var(--primary-light);
        }

        .nav-item i {
            width: 24px;
            margin-right: 12px;
            text-align: center;
        }

        .card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background-color: var(--header-bg);
            transform: translateY(-1px);
        }

        .attendance-present {
            background-color: #DCFCE7;
            color: #166534;
        }

        .attendance-absent {
            background-color: #FEE2E2;
            color: #991B1B;
        }

        .attendance-late {
            background-color: #FEF3C7;
            color: #92400E;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .main-content.shifted {
                margin-left: 280px;
            }
        }

        /* Loading spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Mobile Menu Button -->
    <button id="mobile-menu-button" class="md:hidden fixed top-4 left-4 z-50 p-2 rounded-md text-white bg-purple-700">
        <i class="fas fa-bars text-xl"></i>
    </button>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="p-6 border-b border-purple-700">
            <h1 class="text-white text-2xl font-bold">
                <i class="fas fa-graduation-cap mr-2"></i>
                <span class="hidden md:inline">AMS Pro</span>
            </h1>
            <div class="text-purple-200 text-sm mt-1">Attendance Management</div>
        </div>
        
        <div class="py-4 overflow-y-auto">
            <a href="#dashboard" class="nav-item active" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            
            <div class="px-6 py-2 text-purple-300 text-xs font-semibold uppercase tracking-wider mt-4">
                Attendance
            </div>
            <a href="#attendance" class="nav-item" data-section="attendance">
                <i class="fas fa-calendar-check"></i>
                <span>Mark Attendance</span>
            </a>
            <a href="#reports" class="nav-item" data-section="reports">
                <i class="fas fa-chart-bar"></i>
                <span>Reports</span>
            </a>
            
            <div class="px-6 py-2 text-purple-300 text-xs font-semibold uppercase tracking-wider mt-4">
                Management
            </div>
            <a href="#students" class="nav-item" data-section="students">
                <i class="fas fa-user-graduate"></i>
                <span>Students</span>
            </a>
            <a href="#classes" class="nav-item" data-section="classes">
                <i class="fas fa-chalkboard"></i>
                <span>Classes</span>
            </a>
            
            <div class="absolute bottom-0 w-full p-4 border-t border-purple-700">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold">
                        <span id="user-initials">U</span>
                    </div>
                    <div class="ml-3">
                        <div class="text-white font-medium" id="user-name">Loading...</div>
                        <div class="text-purple-200 text-xs" id="user-role">Role</div>
                    </div>
                    <button id="logout-btn" class="ml-auto text-purple-200 hover:text-white">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content min-h-screen" id="main-content">
        <!-- Header -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-semibold text-gray-800" id="page-title">Dashboard</h2>
                    <p class="text-sm text-gray-500" id="page-description">Welcome to your dashboard</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="hidden md:block text-right">
                        <div class="text-sm text-gray-500" id="current-date">Loading date...</div>
                        <div class="text-lg font-semibold text-gray-800" id="current-time">--:-- --</div>
                    </div>
                    <div class="relative">
                        <button id="notifications-btn" class="p-2 text-gray-500 hover:text-purple-600 relative">
                            <i class="fas fa-bell text-xl"></i>
                            <span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="card p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-purple-100 text-purple-600 mr-4">
                            <i class="fas fa-user-graduate text-2xl"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Total Students</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="total-students">0</h3>
                            <p class="text-xs text-gray-500"><span id="students-present">0</span> present today</p>
                        </div>
                    </div>
                </div>
                
                <div class="card p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
                            <i class="fas fa-chalkboard-teacher text-2xl"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Total Classes</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="total-classes">0</h3>
                            <p class="text-xs text-gray-500">Active classes</p>
                        </div>
                    </div>
                </div>
                
                <div class="card p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
                            <i class="fas fa-calendar-check text-2xl"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Today's Attendance</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="attendance-rate">0%</h3>
                            <p class="text-xs text-gray-500">Average attendance</p>
                        </div>
                    </div>
                </div>
                
                <div class="card p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mr-4">
                            <i class="fas fa-exclamation-triangle text-2xl"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Pending Actions</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="pending-actions">0</h3>
                            <p class="text-xs text-gray-500">Requires attention</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity & Quick Actions -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- Recent Activity -->
                <div class="lg:col-span-2">
                    <div class="card p-6 h-full">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Recent Activity</h3>
                            <button class="text-sm text-purple-600 hover:text-purple-800">View All</button>
                        </div>
                        <div class="space-y-4" id="recent-activity">
                            <div class="flex items-start">
                                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-900">New student registered</p>
                                    <p class="text-sm text-gray-500">John Doe joined Class 10-A</p>
                                    <p class="text-xs text-gray-400">2 hours ago</p>
                                </div>
                            </div>
                            <!-- More activity items will be added dynamically -->
                        </div>
                        <div class="mt-4 text-center" id="loading-activity">
                            <div class="spinner mx-auto"></div>
                            <p class="text-sm text-gray-500 mt-2">Loading activities...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div>
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Actions</h3>
                        <div class="space-y-3">
                            <button class="w-full flex items-center justify-between p-3 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors">
                                <div class="flex items-center">
                                    <div class="p-2 bg-purple-100 rounded-lg mr-3">
                                        <i class="fas fa-user-plus text-purple-600"></i>
                                    </div>
                                    <span>Add New Student</span>
                                </div>
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </button>
                            
                            <button class="w-full flex items-center justify-between p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors">
                                <div class="flex items-center">
                                    <div class="p-2 bg-blue-100 rounded-lg mr-3">
                                        <i class="fas fa-calendar-plus text-blue-600"></i>
                                    </div>
                                    <span>Mark Attendance</span>
                                </div>
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </button>
                            
                            <button class="w-full flex items-center justify-between p-3 bg-green-50 hover:bg-green-100 rounded-lg transition-colors">
                                <div class="flex items-center">
                                    <div class="p-2 bg-green-100 rounded-lg mr-3">
                                        <i class="fas fa-chart-pie text-green-600"></i>
                                    </div>
                                    <span>Generate Report</span>
                                </div>
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </button>
                            
                            <button class="w-full flex items-center justify-between p-3 bg-yellow-50 hover:bg-yellow-100 rounded-lg transition-colors">
                                <div class="flex items-center">
                                    <div class="p-2 bg-yellow-100 rounded-lg mr-3">
                                        <i class="fas fa-bell text-yellow-600"></i>
                                    </div>
                                    <span>Send Notifications</span>
                                </div>
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Today's Summary -->
                    <div class="card p-6 mt-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Today's Summary</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Total Students</span>
                                <span class="font-medium" id="summary-total">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Present</span>
                                <span class="font-medium text-green-600" id="summary-present">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Absent</span>
                                <span class="font-medium text-red-600" id="summary-absent">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Late</span>
                                <span class="font-medium text-yellow-600" id="summary-late">0</span>
                            </div>
                            <div class="pt-2 mt-2 border-t border-gray-100">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium">Attendance Rate</span>
                                    <span class="font-bold text-purple-600" id="summary-rate">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                    <div class="bg-purple-600 h-2 rounded-full" id="attendance-progress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Upcoming Events -->
            <div class="card p-6 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">Upcoming Events</h3>
                    <button class="text-sm text-purple-600 hover:text-purple-800">View Calendar</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Event</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Location</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th scope="col" class="relative px-6 py-3"><span class="sr-only">Action</span></th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="events-list">
                            <!-- Events will be loaded here -->
                            <tr>
                                <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">
                                    <div class="spinner mx-auto"></div>
                                    <p class="mt-2">Loading events...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="bg-white border-t border-gray-200 py-4">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <p class="text-sm text-gray-500"> 2025 Attendance Management System. All rights reserved.</p>
                    <div class="flex space-x-6 mt-4 md:mt-0">
                        <a href="#" class="text-gray-400 hover:text-gray-500">
                            <span class="sr-only">Help</span>
                            <i class="fas fa-question-circle"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-gray-500">
                            <span class="sr-only">Settings</span>
                            <i class="fas fa-cog"></i>
                        </a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed bottom-4 right-4 space-y-2 z-50">
        <!-- Toast messages will be added here dynamically -->
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl flex flex-col items-center">
            <div class="spinner"></div>
            <p class="mt-4 text-gray-700" id="loading-message">Loading, please wait...</p>
        </div>
    </div>

    <!-- Firebase and App Scripts -->
    <script type="module" src="/src/js/firebase-config.js"></script>
    <script type="module" src="/src/js/auth-service.js"></script>
    <script type="module" src="/src/js/student-service.js"></script>
    <script type="module">
        // Import services
        import { authService } from '/src/js/auth-service.js';
        import { studentService } from '/src/js/student-service.js';
        
        // DOM Elements
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const logoutButton = document.getElementById('logout-btn');
        const currentDateElement = document.getElementById('current-date');
        const currentTimeElement = document.getElementById('current-time');
        
        // Stats elements
        const totalStudentsElement = document.getElementById('total-students');
        const totalClassesElement = document.getElementById('total-classes');
        const attendanceRateElement = document.getElementById('attendance-rate');
        const pendingActionsElement = document.getElementById('pending-actions');
        
        // Summary elements
        const summaryTotalElement = document.getElementById('summary-total');
        const summaryPresentElement = document.getElementById('summary-present');
        const summaryAbsentElement = document.getElementById('summary-absent');
        const summaryLateElement = document.getElementById('summary-late');
        const summaryRateElement = document.getElementById('summary-rate');
        const attendanceProgressElement = document.getElementById('attendance-progress');
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize UI components
            initMobileMenu();
            updateDateTime();
            setInterval(updateDateTime, 60000); // Update time every minute
            
            // Set up event listeners
            if (logoutButton) {
                logoutButton.addEventListener('click', handleLogout);
            }
            
            // Check authentication state
            checkAuthState();
            
            // Load dashboard data
            loadDashboardData();
        });
        
        // Mobile menu toggle
        function initMobileMenu() {
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    sidebar.classList.toggle('active');
                    mainContent.classList.toggle('shifted');
                });
            }
            
            // Close menu when clicking outside on mobile
            document.addEventListener('click', (e) => {
                if (window.innerWidth < 768 && 
                    !sidebar.contains(e.target) && 
                    e.target !== mobileMenuButton && 
                    !mobileMenuButton.contains(e.target)) {
                    sidebar.classList.remove('active');
                    mainContent.classList.remove('shifted');
                }
            });
        }
        
        // Update date and time
        function updateDateTime() {
            const now = new Date();
            
            // Format date (e.g., Monday, January 1, 2025)
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            currentDateElement.textContent = now.toLocaleDateString('en-US', options);
            
            // Format time (e.g., 2:30 PM)
            currentTimeElement.textContent = now.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });
        }
        
        // Check authentication state
        async function checkAuthState() {
            try {
                const user = authService.currentUser;
                if (!user) {
                    // Redirect to login if not authenticated
                    window.location.href = '/login.html';
                    return;
                }
                
                // Update user info in the UI
                updateUserInfo(user);
                
            } catch (error) {
                console.error('Auth state error:', error);
                showToast('Error checking authentication status', 'error');
            }
        }
        
        // Update user information in the UI
        function updateUserInfo(user) {
            const userNameElement = document.getElementById('user-name');
            const userRoleElement = document.getElementById('user-role');
            const userInitialsElement = document.getElementById('user-initials');
            
            if (userNameElement) {
                const displayName = user.displayName || user.email.split('@')[0];
                userNameElement.textContent = displayName;
                
                // Set user initials for avatar
                if (userInitialsElement) {
                    const initials = displayName.split(' ')
                        .map(part => part[0])
                        .join('')
                        .toUpperCase()
                        .substring(0, 2);
                    userInitialsElement.textContent = initials;
                }
            }
            
            if (userRoleElement) {
                // This would come from your user document in Firestore
                userRoleElement.textContent = 'Teacher'; // Default role
            }
        }
        
        // Handle logout
        async function handleLogout() {
            try {
                await authService.signOut();
                window.location.href = '/login.html';
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Error logging out', 'error');
            }
        }
        
        // Load dashboard data
        async function loadDashboardData() {
            try {
                showLoading('Loading dashboard data...');
                
                // Load stats
                await loadStats();
                
                // Load recent activity
                await loadRecentActivity();
                
                // Load upcoming events
                await loadUpcomingEvents();
                
                hideLoading();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showToast('Error loading dashboard data', 'error');
                hideLoading();
            }
        }
        
        // Load dashboard statistics
        async function loadStats() {
            try {
                // In a real app, you would fetch this data from your backend
                // For now, we'll use mock data
                const stats = {
                    totalStudents: 124,
                    totalClasses: 8,
                    attendanceRate: 87.5,
                    presentToday: 108,
                    absentToday: 12,
                    lateToday: 4
                };
                
                // Update the UI with stats
                totalStudentsElement.textContent = stats.totalStudents.toLocaleString();
                totalClassesElement.textContent = stats.totalClasses;
                attendanceRateElement.textContent = `${stats.attendanceRate}%`;
                
                // Update summary section
                summaryTotalElement.textContent = stats.totalStudents;
                summaryPresentElement.textContent = stats.presentToday;
                summaryAbsentElement.textContent = stats.absentToday;
                summaryLateElement.textContent = stats.lateToday;
                
                // Calculate and update attendance rate in summary
                const totalAttended = stats.presentToday + stats.lateToday;
                const attendanceRate = Math.round((totalAttended / stats.totalStudents) * 100);
                summaryRateElement.textContent = `${attendanceRate}%`;
                attendanceProgressElement.style.width = `${attendanceRate}%`;
                
                // Update students present today
                document.getElementById('students-present').textContent = stats.presentToday;
                
                // Update pending actions (example: students with missing attendance)
                const pendingActions = stats.absentToday + stats.lateToday;
                pendingActionsElement.textContent = pendingActions;
                
            } catch (error) {
                console.error('Error loading stats:', error);
                throw error;
            }
        }
        
        // Load recent activity
        async function loadRecentActivity() {
            try {
                // In a real app, you would fetch this from your backend
                const activities = [
                    {
                        id: 1,
                        type: 'attendance',
                        title: 'Attendance marked',
                        description: 'Marked attendance for Class 10-A',
                        time: '10 minutes ago',
                        icon: 'calendar-check',
                        color: 'purple'
                    },
                    {
                        id: 2,
                        type: 'student',
                        title: 'New student registered',
                        description: 'Sarah Johnson joined Class 9-B',
                        time: '2 hours ago',
                        icon: 'user-plus',
                        color: 'blue'
                    },
                    {
                        id: 3,
                        type: 'report',
                        title: 'Monthly report generated',
                        description: 'September 2025 attendance report',
                        time: '1 day ago',
                        icon: 'file-alt',
                        color: 'green'
                    },
                    {
                        id: 4,
                        type: 'system',
                        title: 'System update',
                        description: 'New features available in version 2.1.0',
                        time: '2 days ago',
                        icon: 'sync',
                        color: 'yellow'
                    }
                ];
                
                const activityContainer = document.getElementById('recent-activity');
                const loadingElement = document.getElementById('loading-activity');
                
                if (activityContainer && loadingElement) {
                    // Hide loading
                    loadingElement.style.display = 'none';
                    
                    // Clear existing content
                    activityContainer.innerHTML = '';
                    
                    // Add activities to the container
                    activities.forEach(activity => {
                        const activityElement = document.createElement('div');
                        activityElement.className = 'flex items-start';
                        activityElement.innerHTML = `
                            <div class="flex-shrink-0 h-10 w-10 rounded-full bg-${activity.color}-100 flex items-center justify-center text-${activity.color}-600">
                                <i class="fas fa-${activity.icon}"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-900">${activity.title}</p>
                                <p class="text-sm text-gray-500">${activity.description}</p>
                                <p class="text-xs text-gray-400">${activity.time}</p>
                            </div>
                        `;
                        activityContainer.appendChild(activityElement);
                    });
                }
                
            } catch (error) {
                console.error('Error loading recent activity:', error);
                throw error;
            }
        }
        
        // Load upcoming events
        async function loadUpcomingEvents() {
            try {
                // In a real app, you would fetch this from your backend
                const events = [
                    {
                        id: 1,
                        title: 'Parent-Teacher Meeting',
                        date: '2025-10-15',
                        time: '2:00 PM - 4:00 PM',
                        location: 'School Auditorium',
                        status: 'upcoming'
                    },
                    {
                        id: 2,
                        title: 'Science Fair',
                        date: '2025-10-20',
                        time: '9:00 AM - 3:00 PM',
                        location: 'School Grounds',
                        status: 'upcoming'
                    },
                    {
                        id: 3,
                        title: 'Mid-Term Exams',
                        date: '2025-11-05',
                        time: 'All day',
                        location: 'Classrooms',
                        status: 'upcoming'
                    },
                    {
                        id: 4,
                        title: 'Sports Day',
                        date: '2025-11-15',
                        time: '8:00 AM - 2:00 PM',
                        location: 'Sports Complex',
                        status: 'upcoming'
                    }
                ];
                
                const eventsList = document.getElementById('events-list');
                
                if (eventsList) {
                    // Clear loading state
                    eventsList.innerHTML = '';
                    
                    if (events.length === 0) {
                        eventsList.innerHTML = `
                            <tr>
                                <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">
                                    No upcoming events found.
                                </td>
                            </tr>
                        `;
                        return;
                    }
                    
                    // Add events to the table
                    events.forEach(event => {
                        const row = document.createElement('tr');
                        
                        // Format date (e.g., Oct 15, 2025)
                        const eventDate = new Date(event.date);
                        const formattedDate = eventDate.toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'short', 
                            day: 'numeric' 
                        });
                        
                        // Status badge
                        let statusClass = 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full ';
                        if (event.status === 'upcoming') {
                            statusClass += 'bg-blue-100 text-blue-800';
                        } else if (event.status === 'in-progress') {
                            statusClass += 'bg-yellow-100 text-yellow-800';
                        } else {
                            statusClass += 'bg-gray-100 text-gray-800';
                        }
                        
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">${event.title}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">${formattedDate}</div>
                                <div class="text-sm text-gray-500">${event.time}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">${event.location}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="${statusClass}">
                                    ${event.status.charAt(0).toUpperCase() + event.status.slice(1)}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <a href="#" class="text-purple-600 hover:text-purple-900">View</a>
                            </td>
                        `;
                        
                        eventsList.appendChild(row);
                    });
                }
                
            } catch (error) {
                console.error('Error loading upcoming events:', error);
                throw error;
            }
        }
        
        // Show loading overlay
        function showLoading(message = 'Loading...') {
            const overlay = document.getElementById('loading-overlay');
            const messageElement = document.getElementById('loading-message');
            
            if (overlay && messageElement) {
                messageElement.textContent = message;
                overlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        }
        
        // Hide loading overlay
        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.classList.add('hidden');
                document.body.style.overflow = '';
            }
        }
        
        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            if (!toastContainer) return;
            
            const toast = document.createElement('div');
            let icon = '';
            let bgColor = 'bg-gray-800';
            
            switch (type) {
                case 'success':
                    icon = 'check-circle';
                    bgColor = 'bg-green-600';
                    break;
                case 'error':
                    icon = 'exclamation-circle';
                    bgColor = 'bg-red-600';
                    break;
                case 'warning':
                    icon = 'exclamation-triangle';
                    bgColor = 'bg-yellow-500';
                    break;
                default:
                    icon = 'info-circle';
            }
            
            toast.className = `${bgColor} text-white px-6 py-4 rounded-lg shadow-lg flex items-center`;
            toast.innerHTML = `
                <i class="fas fa-${icon} mr-3"></i>
                <span>${message}</span>
                <button class="ml-4 text-white opacity-75 hover:opacity-100" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode === toastContainer) {
                    toastContainer.removeChild(toast);
                }
            }, 5000);
        }
        
        // Make showToast available globally for debugging
        window.showToast = showToast;
    </script>
</body>
</html>